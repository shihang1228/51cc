(function(window,$){var Main={init:function(){this.cacheElement().bindEvent().initStatus().getTimestamp();},cacheElement:function(){var that=this;$.each([".login_a",".application","#mask",".upload_bomb",".card1",".card2",".upload_box1",".upload_box2",".close",".cancel",".countdown-box","#threeOne","#shangchuang","#threeTwo",".more",".more_area",".status1_btn",".status2_btn"],function(i,item){that['$'+$.camelCase(item.replace(/\_/,'-')).replace(/\#|\./,"")]=$(item);});return that;},initStatus:function(){var that=this,maxWidth=500;$(".count_character_length").each(function(){var $this=$(this),width=$this.width()+ 10,$wrapper=$this.parent(),$target=$wrapper.find(".jinjia_product_desc");if(width>maxWidth){width=maxWidth;$target.addClass("ellipsis");}
$target.width(width);$wrapper.find(".jinjia_special").show();$this.remove();});return that;},bindEvent:function(){var that=this;that.$loginA.on("click",function(){$.getJSON("common/check_login",function(rs){if(rs.status==1){}else{show_dialog_login();}});});that.$status2Btn.on("click",function(){$.getJSON("common/check_login",function(rs){if(rs.status==1){}else{show_dialog_login();}});});that.$more.on("click",function(){that.$moreArea.show();});that.$application.on("click",function(){that.$mask.show();that.$shangchuang.show();});that.$status1Btn.on("click",function(){that.$mask.show();that.$shangchuang.show();});that.$card1.on("click",function(){that.$uploadBox1.hide();that.$uploadBox2.show();});that.$card2.on("click",function(){that.$uploadBox2.hide();that.$uploadBox1.show();});that.$close.on("click",function(){that.closeBomb();});that.$cancel.on("click",function(){that.closeBomb();});$(document).on("change",".file",function(){that.ajaxupload(this);});that.$threeOne.on("click",function(){var str1=$.trim(that.$uploadBox1.find(".m").eq(0).html());var str2=$.trim(that.$uploadBox1.find(".m").eq(1).html());var str3=$.trim(that.$uploadBox1.find(".m").eq(2).html());var str4=$.trim(that.$uploadBox1.find(".m").eq(3).html());var isThreeOne=$(this).attr("data-isthreeone");if(str1!='上传成功，审核中'){layer.msg('请上传营业执照',{time:2000});}else if(str2!='上传成功，审核中'){layer.msg('请上传组织机构代码证',{time:2000});}else if(str3!='上传成功，审核中'){layer.msg('请上传税务登记证',{time:2000});}else if(str4!='上传成功，审核中'){layer.msg('请上传法人授权委托书',{time:2000});}else if(!that.$uploadBox1.find(".has-readed").is(":checked")){layer.msg('请先阅读并接受《找塑料网竞价协议》',{time:2000});}else{that.uploadCaredAjax(isThreeOne);}});that.$threeTwo.on("click",function(){var str1=$.trim(that.$uploadBox2.find(".m").eq(0).html());var str2=$.trim(that.$uploadBox2.find(".m").eq(1).html());var isThreeOne=$(this).attr("data-isthreeone");if(str1!='上传成功，审核中'){layer.msg('请上传营业执照',{time:2000});}else if(str2!='上传成功，审核中'){layer.msg('请上传法人授权委托书',{time:2000});}else if(!that.$uploadBox2.find(".has-readed").is(":checked")){layer.msg('请先阅读并接受《找塑料网竞价协议》',{time:2000});}else{that.uploadCaredAjax(isThreeOne);}});return that;},closeBomb:function(){var that=this;that.$mask.hide();that.$uploadBomb.hide();},uploadCaredAjax:function(isThreeOne){$.post('jingjia/save_file',{isThreeOne:isThreeOne},function(res){if(res.status==1){layer.msg('提交成功',{time:2000});setTimeout(function(){window.location.reload();},400);}else{layer.msg('提交失败，请重新提交',{time:2000});}},"json")},getTimestamp:function(){var that=this;that.$countdownBox.each(function(){var startTime=$(this).find(".startTime").val();var endTime=$(this).find(".endTime").val();startTime=startTime.replace(/\-/g,'\/');endTime=endTime.replace(/\-/g,'\/');var startDt=new Date(startTime).getTime();var endDt=new Date(endTime).getTime();that.startCountdown(startDt,endDt,this);});},startCountdown:function(startDt,endDt,obj){var that=this;clearInterval(obj.timer);obj.timer=setInterval(function(){startDt+=1000;if(startDt>endDt){clearInterval(obj.timer);window.location.reload(true);}else{that.countdown(startDt,endDt,obj);};},1000)},countdown:function(startDt,endDt,obj){var cha=(endDt-startDt)/1000;var hours=parseInt(cha/3600)<10?'0'+parseInt(cha/3600):parseInt(cha/3600);cha=(cha%3600);var minutes=parseInt(cha/60)<10?'0'+parseInt(cha/60):parseInt(cha/60);cha=cha%60;var seconds=cha<10?'0'+cha:cha;$(obj).find(".hours").html(hours);$(obj).find(".minutes").html(minutes);$(obj).find(".seconds").html(seconds);},ajaxupload:function(obj){var that=this;var idx=$(obj).attr('id');var type=$(obj).attr('data-type');var value=$(obj).val();var $obj=$(obj).closest("li").find(".m");value=(value.substring(value.lastIndexOf(".")+1)).toLowerCase();var arr=['jpg','jpeg','png','gif'];var flag=$.inArray(value,arr);if(flag>-1){$.ajaxFileUpload({global:false,dataType:"json",secureuri:false,fileElementId:idx,url:"/jingjia/upload_file?token="+ getCookie("token")+"&date="+ new Date().getTime(),data:{type:type},success:function(res){if(res.status=='1'){layer.msg('上传成功',{time:2000});$obj.html('上传成功，审核中').css('color','#666')}else{layer.msg("上传失败",{time:2000});}},error:function(res){layer.msg(res.msg);}});}else{layer.msg('请上传格式为'+(arr.join(","))+'文件格式',{time:2000});}}};Main.init();})(this,jQuery)